#!/bin/vbash
# VyOS Configuration for Core-1 Router
# Role: MPLS P Router (Provider Core)

# System configuration
set system host-name 'core-1'
set system domain-name 'telco.lab'
set system time-zone 'UTC'

# Configure loopback interface (Router ID)
set interfaces loopback lo address '10.0.0.11/32'
set interfaces loopback lo description 'Router ID and MPLS LSR-ID'

# Interface to PE-1
set interfaces ethernet eth0 address '10.1.1.2/30'
set interfaces ethernet eth0 description 'Link to PE-1'
set interfaces ethernet eth0 mtu '9000'

# Interface to Core-2 (primary)
set interfaces ethernet eth1 address '10.1.2.2/30'
set interfaces ethernet eth1 description 'Link to Core-2 Primary'
set interfaces ethernet eth1 mtu '9000'

# Interface to Core-2 (backup)
set interfaces ethernet eth2 address '10.1.4.1/30'
set interfaces ethernet eth2 description 'Link to Core-2 Backup'
set interfaces ethernet eth2 mtu '9000'

# OSPF Configuration
set protocols ospf area 0 network '10.0.0.11/32'
set protocols ospf area 0 network '10.1.1.0/30'
set protocols ospf area 0 network '10.1.2.0/30'
set protocols ospf area 0 network '10.1.4.0/30'
set protocols ospf router-id '10.0.0.11'
set protocols ospf log-adjacency-changes
set protocols ospf parameters router-id '10.0.0.11'

# OSPF interface tuning for high-speed links
set protocols ospf area 0 area-type normal
set protocols ospf interface eth0 cost 10
set protocols ospf interface eth1 cost 10
set protocols ospf interface eth2 cost 20
set protocols ospf interface eth0 hello-interval 1
set protocols ospf interface eth1 hello-interval 1
set protocols ospf interface eth2 hello-interval 1
set protocols ospf interface eth0 dead-interval 4
set protocols ospf interface eth1 dead-interval 4
set protocols ospf interface eth2 dead-interval 4

# MPLS Configuration
set protocols mpls interface eth0
set protocols mpls interface eth1
set protocols mpls interface eth2
set protocols mpls ldp router-id '10.0.0.11'
set protocols mpls ldp interface eth0
set protocols mpls ldp interface eth1
set protocols mpls ldp interface eth2

# BGP Configuration (Route Reflector)
set protocols bgp 65001 router-id '10.0.0.11'
set protocols bgp 65001 parameters log-neighbor-changes
set protocols bgp 65001 neighbor 10.0.0.1 remote-as '65001'
set protocols bgp 65001 neighbor 10.0.0.1 update-source 'loopback'
set protocols bgp 65001 neighbor 10.0.0.1 route-reflector-client
set protocols bgp 65001 neighbor 10.0.0.2 remote-as '65001'
set protocols bgp 65001 neighbor 10.0.0.2 update-source 'loopback'
set protocols bgp 65001 neighbor 10.0.0.2 route-reflector-client
set protocols bgp 65001 neighbor 10.0.0.12 remote-as '65001'
set protocols bgp 65001 neighbor 10.0.0.12 update-source 'loopback'

# BGP Address Families
set protocols bgp 65001 address-family ipv4-unicast network '10.0.0.11/32'
set protocols bgp 65001 address-family ipv4-labeled-unicast neighbor 10.0.0.1 activate
set protocols bgp 65001 address-family ipv4-labeled-unicast neighbor 10.0.0.2 activate
set protocols bgp 65001 address-family ipv4-labeled-unicast neighbor 10.0.0.12 activate

# QoS Configuration
set traffic-policy shaper CORE-OUT bandwidth '10gbit'
set traffic-policy shaper CORE-OUT class 10 bandwidth '30%'
set traffic-policy shaper CORE-OUT class 10 description 'Voice Traffic'
set traffic-policy shaper CORE-OUT class 10 match VOICE ip dscp 'ef'
set traffic-policy shaper CORE-OUT class 10 priority 7
set traffic-policy shaper CORE-OUT class 20 bandwidth '40%'
set traffic-policy shaper CORE-OUT class 20 description 'Video Traffic'
set traffic-policy shaper CORE-OUT class 20 match VIDEO ip dscp 'af41'
set traffic-policy shaper CORE-OUT class 20 priority 5
set traffic-policy shaper CORE-OUT class 30 bandwidth '30%'
set traffic-policy shaper CORE-OUT class 30 description 'Data Traffic'
set traffic-policy shaper CORE-OUT class 30 match DATA ip dscp 'af21'
set traffic-policy shaper CORE-OUT default bandwidth '100%'
set traffic-policy shaper CORE-OUT default priority 1

# Apply QoS to interfaces
set interfaces ethernet eth0 traffic-policy out 'CORE-OUT'
set interfaces ethernet eth1 traffic-policy out 'CORE-OUT'
set interfaces ethernet eth2 traffic-policy out 'CORE-OUT'

# Management and monitoring
set service ssh port '22'
set service ssh listen-address '10.0.0.11'
set system login user admin authentication plaintext-password 'vyos123'
set system login user admin level 'admin'

# SNMP for monitoring
set service snmp community 'telco-lab' authorization 'ro'
set service snmp community 'telco-lab' network '192.168.100.0/24'
set service snmp location 'Core-1 Router - Telco Lab'
set service snmp contact 'lab-admin@telco.lab'

# Logging
set system syslog global facility all level 'info'
set system syslog host 192.168.100.10 facility all level 'info'

# NTP
set system ntp server 'pool.ntp.org'

# Save configuration
commit
save
